<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CERO | Ultra</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --discord-blurple: #5865F2; --discord-dark: #313338; --discord-card: #2b2d31; --neon-cyan: #00f5d4; }
        body { background: var(--discord-dark); color: #dbdee1; font-family: 'Outfit', sans-serif; margin: 0; padding-bottom: 100px; }
        
        header { background: #1e1f22; padding: 15px; text-align: center; border-bottom: 1px solid #1a1b1e; position: sticky; top: 0; z-index: 100; }
        h1 { margin: 0; font-weight: 800; font-size: 1.2rem; letter-spacing: 2px; color: white; }

        #feed { max-width: 550px; margin: 20px auto; padding: 0 10px; }
        
        .post { background: var(--discord-card); border-radius: 8px; padding: 16px; margin-bottom: 12px; position: relative; border: 1px solid transparent; }
        .post:hover { background: #2e3035; }
        
        .post-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .user-info { display: flex; align-items: center; gap: 10px; color: white; font-weight: 600; }
        .avatar { width: 40px; height: 40px; background: var(--discord-blurple); border-radius: 50%; }
        
        .delete-btn { cursor: pointer; color: #ed4245; opacity: 0.5; transition: 0.3s; background: none; border: none; }
        .delete-btn:hover { opacity: 1; }

        .post-content { font-size: 1rem; color: #dbdee1; line-height: 1.4; white-space: pre-wrap; }
        .post-gif { width: 100%; border-radius: 8px; margin-top: 10px; max-height: 300px; object-fit: cover; }

        .post-footer { margin-top: 12px; display: flex; gap: 15px; border-top: 1px solid #3f4147; padding-top: 10px; }
        .action-btn { background: none; border: none; color: #b5bac1; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.9rem; transition: 0.2s; }
        .action-btn:hover { color: white; }
        .action-btn.active { color: var(--neon-cyan); }

        /* Comentarios */
        .comments-section { margin-top: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; padding: 10px; display: none; }
        .comment { font-size: 0.85rem; padding: 5px 0; border-bottom: 1px solid #3f4147; }
        .comment-input { width: 100%; background: #1e1f22; border: none; color: white; padding: 8px; border-radius: 4px; margin-top: 5px; font-size: 0.8rem; }

        /* Bot√≥n Flotante */
        .fab { position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; background: var(--discord-blurple); border-radius: 50%; border: none; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }

        /* Modal Nuevo Post */
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal-box { width: 90%; max-width: 450px; background: var(--discord-card); padding: 20px; border-radius: 8px; }
        textarea { width: 100%; height: 100px; background: #1e1f22; color: white; border: none; padding: 10px; border-radius: 5px; resize: none; box-sizing: border-box; }
        .modal-btns { display: flex; justify-content: space-between; margin-top: 10px; }
    </style>
</head>
<body>

<header><h1>CERO | CANAL CHISMES</h1></header>

<div id="feed"></div>

<button class="fab" onclick="toggleModal(true)">+</button>

<div id="modal">
    <div class="modal-box">
        <textarea id="postText" placeholder="¬øQu√© est√° pasando en el liceo?"></textarea>
        <input type="text" id="postGif" placeholder="Link de GIF (Pronto buscador directo)" style="width:100%; margin-top:10px; background:#1e1f22; border:none; color:white; padding:8px; border-radius:5px;">
        <div class="modal-btns">
            <button onclick="toggleModal(false)" style="color:#b5bac1; background:none; border:none; cursor:pointer;">Cancelar</button>
            <button onclick="enviarPost()" style="background:var(--discord-blurple); color:white; border:none; padding:8px 20px; border-radius:3px; font-weight:600; cursor:pointer;">Publicar</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBqWmGTsmfFJSy9x5ld9Rb5u9GEBBKF2FE",
      authDomain: "venepop-b642b.firebaseapp.com",
      databaseURL: "https://venepop-b642b-default-rtdb.firebaseio.com/",
      projectId: "venepop-b642b",
      storageBucket: "venepop-b642b.firebasestorage.app",
      messagingSenderId: "257279813856",
      appId: "1:257279813856:web:32733306545744437e8885"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function toggleModal(show) { document.getElementById('modal').style.display = show ? 'flex' : 'none'; }

    async function enviarPost() {
        const texto = document.getElementById('postText').value;
        const gif = document.getElementById('postGif').value;
        if(!texto && !gif) return;

        await db.ref('posts').push({
            texto, gif, likes: 0, fecha: Date.now()
        });
        toggleModal(false);
        document.getElementById('postText').value = "";
        document.getElementById('postGif').value = "";
    }

    function toggleComments(id) {
        const div = document.getElementById(`comments-${id}`);
        div.style.display = div.style.display === 'block' ? 'none' : 'block';
    }

    async function enviarComentario(e, id) {
        if(e.key === 'Enter' && e.target.value !== "") {
            await db.ref(`posts/${id}/comentarios`).push({
                texto: e.target.value,
                fecha: Date.now()
            });
            e.target.value = "";
        }
    }

    function deletePost(id) {
        if(confirm("¬øQuieres borrar este chisme?")) db.ref(`posts/${id}`).remove();
    }

    function darLike(id) {
        if(localStorage.getItem('liked_'+id)) return alert("Ya diste tu opini√≥n.");
        db.ref(`posts/${id}/likes`).transaction(l => (l || 0) + 1);
        localStorage.setItem('liked_'+id, true);
    }

    db.ref('posts').on('value', snap => {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";
        const data = [];
        snap.forEach(child => { data.push({id: child.key, ...child.val()}) });

        data.reverse().forEach(p => {
            let htmlComments = "";
            if(p.comentarios) {
                Object.values(p.comentarios).forEach(c => {
                    htmlComments += `<div class="comment"><b>@anon:</b> ${c.texto}</div>`;
                });
            }

            feed.insertAdjacentHTML('beforeend', `
                <div class="post">
                    <div class="post-header">
                        <div class="user-info"><div class="avatar"></div> An√≥nimo</div>
                        <button class="delete-btn" onclick="deletePost('${p.id}')">üóëÔ∏è</button>
                    </div>
                    <div class="post-content">${p.texto}</div>
                    ${p.gif ? `<img src="${p.gif}" class="post-gif">` : ''}
                    <div class="post-footer">
                        <button class="action-btn" onclick="darLike('${p.id}')">üî• ${p.likes || 0}</button>
                        <button class="action-btn" onclick="toggleComments('${p.id}')">üí¨ Debate</button>
                    </div>
                    <div class="comments-section" id="comments-${p.id}">
                        <div id="list-${p.id}">${htmlComments}</div>
                        <input type="text" class="comment-input" placeholder="Escribe tu opini√≥n..." onkeypress="enviarComentario(event, '${p.id}')">
                    </div>
                </div>
            `);
        });
    });
</script>
</body>
</html>